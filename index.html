<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projeto 300</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: 'Segoe UI', sans-serif; background: #0a0e27; color: #fff; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { text-align: center; font-size: 2.5rem; margin-bottom: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }
        .login-container { max-width: 400px; margin: 100px auto; text-align: center; background: #1a1f3a; padding: 40px; border-radius: 12px; border: 1px solid #2a3150; }
        .login-btn { background: #fff; color: #000; border: none; padding: 12px 30px; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; display: flex; align-items: center; gap: 10px; margin: 20px auto; }
        .stats { display: flex; gap: 20px; justify-content: center; margin-bottom: 30px; }
        .stat-card { background: #1a1f3a; padding: 20px 40px; border-radius: 12px; border: 1px solid #2a3150; }
        .stat-label { font-size: 0.9rem; color: #8b92b0; text-transform: uppercase; display: block; margin-bottom: 8px; }
        .stat-value { font-size: 2rem; font-weight: bold; }
        .positive { color: #10b981; }
        .negative { color: #ef4444; }
        .btn-primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border: none; padding: 12px 30px; border-radius: 8px; font-size: 1rem; font-weight: 600; cursor: pointer; margin-bottom: 20px; }
        .btn-logout { background: #ef4444; color: white; border: none; padding: 8px 20px; border-radius: 6px; font-size: 0.9rem; cursor: pointer; float: right; }
        .form-card { background: #1a1f3a; padding: 30px; border-radius: 12px; margin-bottom: 30px; border: 1px solid #2a3150; display: none; }
        .form-card.active { display: block; }
        .form-section { margin: 20px 0; padding: 20px; background: #0f1425; border-radius: 8px; border-left: 4px solid #667eea; }
        .form-row { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 15px; }
        .form-group { display: flex; flex-direction: column; gap: 8px; }
        .form-group label { font-size: 0.9rem; color: #8b92b0; }
        .form-group input { background: #0f1425; border: 1px solid #2a3150; padding: 12px; border-radius: 6px; color: white; font-size: 1rem; }
        .btn-submit { background: #10b981; color: white; border: none; padding: 14px 40px; border-radius: 8px; font-size: 1.1rem; font-weight: 600; cursor: pointer; width: 100%; margin-top: 20px; }
        .table-container { background: #1a1f3a; border-radius: 12px; overflow-x: auto; border: 1px solid #2a3150; margin-bottom: 30px; }
        table { width: 100%; border-collapse: collapse; }
        th { padding: 15px; text-align: center; font-weight: 600; border-bottom: 2px solid #2a3150; color: #8b92b0; text-transform: uppercase; font-size: 0.85rem; background: #0f1425; }
        .header-fulltbet { background: #fbbf24; color: #000; }
        .header-betbra { background: #10b981; color: #000; }
        td { padding: 15px; text-align: center; border-bottom: 1px solid #2a3150; }
        tr:hover { background: #1f2544; }
        .btn-action { background: transparent; border: none; font-size: 1.2rem; cursor: pointer; margin: 0 5px; }
        .btn-edit { color: #3b82f6; }
        .empty-state { padding: 60px 20px; text-align: center; color: #8b92b0; }
        .monthly-summary { background: #1a1f3a; border-radius: 12px; padding: 30px; border: 1px solid #2a3150; }
        .monthly-summary h2 { margin-bottom: 20px; color: #667eea; }
        .month-card { background: #0f1425; padding: 20px; border-radius: 8px; margin-bottom: 15px; border-left: 4px solid #667eea; display: flex; justify-content: space-between; align-items: center; }
        .month-name { font-size: 1.2rem; font-weight: 600; }
        .month-value { font-size: 1.5rem; font-weight: bold; }
        .user-info { text-align: right; margin-bottom: 20px; color: #8b92b0; }
        #app { display: none; }
        #login { display: block; }
    </style>
</head>
<body>
    <!-- Login Screen -->
    <div id="login">
        <div class="login-container">
            <h1>‚öΩ Projeto 300</h1>
            <p style="color: #8b92b0; margin: 20px 0;">Fa√ßa login para acessar seus dados</p>
            <button class="login-btn" onclick="loginWithGoogle()">
                <svg width="20" height="20" viewBox="0 0 24 24"><path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/><path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/><path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/><path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/></svg>
                Entrar com Google
            </button>
        </div>
    </div>

    <!-- Main App -->
    <div id="app">
        <div class="container">
            <div class="user-info">
                <span id="userName"></span>
                <button class="btn-logout" onclick="logout()">Sair</button>
            </div>
            <h1>‚öΩ Projeto 300</h1>
            <div class="stats">
                <div class="stat-card">
                    <span class="stat-label">P/L Total</span>
                    <span class="stat-value" id="plTotal">R$ 0,00</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Dias</span>
                    <span class="stat-value" id="diasCount">0</span>
                </div>
            </div>
            <div style="text-align: center;">
                <button class="btn-primary" onclick="toggleForm()">+ Novo Dia</button>
            </div>
            <form class="form-card" id="form" onsubmit="handleSubmit(event)">
                <h2 id="formTitle">Registrar Novo Dia</h2>
                <input type="hidden" id="editId">
                <div class="form-row">
                    <div class="form-group">
                        <label>Data</label>
                        <input type="date" id="data" required>
                    </div>
                    <div class="form-group">
                        <label>Stake do Dia</label>
                        <input type="number" step="0.01" id="stakeDia" required>
                    </div>
                </div>
                <div class="form-section">
                    <h3>üü° FULLTBET</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Saldo In√≠cio</label>
                            <input type="number" step="0.01" id="fulltbetInicio" required>
                        </div>
                        <div class="form-group">
                            <label>Saldo Fim</label>
                            <input type="number" step="0.01" id="fulltbetFim">
                        </div>
                    </div>
                </div>
                <div class="form-section">
                    <h3>üü¢ BETBRA</h3>
                    <div class="form-row">
                        <div class="form-group">
                            <label>Saldo In√≠cio</label>
                            <input type="number" step="0.01" id="betbraInicio" required>
                        </div>
                        <div class="form-group">
                            <label>Saldo Fim</label>
                            <input type="number" step="0.01" id="betbraFim">
                        </div>
                    </div>
                </div>
                <button type="submit" class="btn-submit">Salvar</button>
            </form>
            <div class="table-container">
                <table>
                    <thead>
                        <tr>
                            <th rowspan="2">DATA</th>
                            <th colspan="3" class="header-fulltbet">FULLTBET</th>
                            <th colspan="3" class="header-betbra">BETBRA</th>
                            <th rowspan="2">STAKE</th>
                            <th rowspan="2">P/L</th>
                            <th rowspan="2">A√á√ïES</th>
                        </tr>
                        <tr>
                            <th>In√≠cio</th>
                            <th>Fim</th>
                            <th>P/L</th>
                            <th>In√≠cio</th>
                            <th>Fim</th>
                            <th>P/L</th>
                        </tr>
                    </thead>
                    <tbody id="tbody">
                        <tr><td colspan="10" class="empty-state">Nenhum dia registrado</td></tr>
                    </tbody>
                </table>
            </div>
            <div class="monthly-summary" id="monthlySummary" style="display:none;">
                <h2>üìä Resumo Mensal</h2>
                <div id="monthlyCards"></div>
            </div>
        </div>
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js';
        import { getAuth, GoogleAuthProvider, signInWithPopup, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js';
        import { getFirestore, collection, addDoc, updateDoc, deleteDoc, doc, query, where, getDocs, orderBy } from 'https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js';

        const firebaseConfig = {
            apiKey: "AIzaSyDjVDzkki4uOthiih4dzWHmuC6j3tZI8yA",
            authDomain: "projeto300-5b5ac.firebaseapp.com",
            projectId: "projeto300-5b5ac",
            storageBucket: "projeto300-5b5ac.firebasestorage.app",
            messagingSenderId: "806295962364",
            appId: "1:806295962364:web:421430b823be9ae43a0d79"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        let currentUser = null;
        let dias = [];

        // Auth functions
        window.loginWithGoogle = async () => {
            const provider = new GoogleAuthProvider();
            try {
                await signInWithPopup(auth, provider);
            } catch (error) {
                alert('Erro ao fazer login: ' + error.message);
            }
        };

        window.logout = async () => {
            try {
                await signOut(auth);
            } catch (error) {
                alert('Erro ao sair: ' + error.message);
            }
        };

        onAuthStateChanged(auth, async (user) => {
            if (user) {
                currentUser = user;
                document.getElementById('login').style.display = 'none';
                document.getElementById('app').style.display = 'block';
                document.getElementById('userName').textContent = user.displayName;
                await loadDias();
            } else {
                currentUser = null;
                document.getElementById('login').style.display = 'block';
                document.getElementById('app').style.display = 'none';
            }
        });

        // Firestore functions
        async function loadDias() {
            const q = query(
                collection(db, 'dias'),
                where('userId', '==', currentUser.uid),
                orderBy('data', 'desc')
            );
            const querySnapshot = await getDocs(q);
            dias = [];
            querySnapshot.forEach((doc) => {
                dias.push({ id: doc.id, ...doc.data() });
            });
            render();
        }

        window.handleSubmit = async (e) => {
            e.preventDefault();
            const data = document.getElementById('data').value;
            const fi = parseFloat(document.getElementById('fulltbetInicio').value);
            const ffVal = document.getElementById('fulltbetFim').value;
            const ff = ffVal ? parseFloat(ffVal) : null;
            const bi = parseFloat(document.getElementById('betbraInicio').value);
            const bfVal = document.getElementById('betbraFim').value;
            const bf = bfVal ? parseFloat(bfVal) : null;
            const stake = parseFloat(document.getElementById('stakeDia').value);
            
            const fpl = ff !== null ? ff - fi : null;
            const bpl = bf !== null ? bf - bi : null;
            const plTotal = (fpl !== null && bpl !== null) ? fpl + bpl : null;

            const editId = document.getElementById('editId').value;

            const diaData = {
                userId: currentUser.uid,
                data,
                fi,
                ff,
                fpl,
                bi,
                bf,
                bpl,
                stake,
                plTotal
            };

            try {
                if (editId) {
                    await updateDoc(doc(db, 'dias', editId), diaData);
                } else {
                    await addDoc(collection(db, 'dias'), diaData);
                }
                resetForm();
                toggleForm();
                await loadDias();
            } catch (error) {
                alert('Erro ao salvar: ' + error.message);
            }
        };

        window.editDia = (id) => {
            const dia = dias.find(d => d.id === id);
            if (!dia) return;

            document.getElementById('editId').value = dia.id;
            document.getElementById('data').value = dia.data;
            document.getElementById('stakeDia').value = dia.stake;
            document.getElementById('fulltbetInicio').value = dia.fi;
            document.getElementById('fulltbetFim').value = dia.ff || '';
            document.getElementById('betbraInicio').value = dia.bi;
            document.getElementById('betbraFim').value = dia.bf || '';
            document.getElementById('formTitle').textContent = 'Editar Dia';
            
            document.getElementById('form').classList.add('active');
        };

        window.deleteDia = async (id) => {
            if (confirm('Excluir este registro?')) {
                try {
                    await deleteDoc(doc(db, 'dias', id));
                    await loadDias();
                } catch (error) {
                    alert('Erro ao excluir: ' + error.message);
                }
            }
        };

        window.toggleForm = () => { 
            const form = document.getElementById('form');
            const isActive = form.classList.contains('active');
            
            if (isActive) {
                form.classList.remove('active');
                resetForm();
            } else {
                form.classList.add('active');
            }
        };

        function resetForm() {
            document.getElementById('form').reset();
            document.getElementById('editId').value = '';
            document.getElementById('formTitle').textContent = 'Registrar Novo Dia';
        }

        function fmt(v) { 
            if (v === null || v === undefined || v === '') return '-';
            return new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(v); 
        }

        function fmtDate(d) { 
            const [y,m,day] = d.split('-'); 
            return day+'/'+m; 
        }

        function getMonthYear(d) { 
            const [y,m] = d.split('-'); 
            const months = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            return months[parseInt(m)-1] + ' ' + y;
        }

        function renderMonthlySummary() {
            const monthlyData = {};
            
            dias.forEach(d => {
                if (d.plTotal !== null) {
                    const monthYear = getMonthYear(d.data);
                    if (!monthlyData[monthYear]) {
                        monthlyData[monthYear] = 0;
                    }
                    monthlyData[monthYear] += d.plTotal;
                }
            });

            const monthlyCards = document.getElementById('monthlyCards');
            const monthlySummary = document.getElementById('monthlySummary');

            if (Object.keys(monthlyData).length === 0) {
                monthlySummary.style.display = 'none';
                return;
            }

            monthlySummary.style.display = 'block';
            
            monthlyCards.innerHTML = Object.entries(monthlyData)
                .sort((a, b) => {
                    const [monthA, yearA] = a[0].split(' ');
                    const [monthB, yearB] = b[0].split(' ');
                    if (yearA !== yearB) return yearB - yearA;
                    const months = ['Janeiro', 'Fevereiro', 'Mar√ßo', 'Abril', 'Maio', 'Junho', 'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                    return months.indexOf(monthB) - months.indexOf(monthA);
                })
                .map(([month, total]) => `
                    <div class="month-card">
                        <span class="month-name">${month}</span>
                        <span class="month-value ${total >= 0 ? 'positive' : 'negative'}">${fmt(total)}</span>
                    </div>
                `).join('');
        }

        function render() {
            const tbody = document.getElementById('tbody');
            const total = dias.reduce((acc, d) => {
                if (d.plTotal !== null) return acc + d.plTotal;
                return acc;
            }, 0);
            
            document.getElementById('plTotal').textContent = fmt(total);
            document.getElementById('plTotal').className = 'stat-value ' + (total >= 0 ? 'positive' : 'negative');
            document.getElementById('diasCount').textContent = dias.length;
            
            if (dias.length === 0) {
                tbody.innerHTML = '<tr><td colspan="10" class="empty-state">Nenhum dia registrado</td></tr>';
                renderMonthlySummary();
                return;
            }
            
            tbody.innerHTML = dias.map(d => `
                <tr>
                    <td>${fmtDate(d.data)}</td>
                    <td>${fmt(d.fi)}</td>
                    <td>${fmt(d.ff)}</td>
                    <td class="${d.fpl !== null ? (d.fpl >= 0 ? 'positive' : 'negative') : ''}">${fmt(d.fpl)}</td>
                    <td>${fmt(d.bi)}</td>
                    <td>${fmt(d.bf)}</td>
                    <td class="${d.bpl !== null ? (d.bpl >= 0 ? 'positive' : 'negative') : ''}">${fmt(d.bpl)}</td>
                    <td>${fmt(d.stake)}</td>
                    <td class="${d.plTotal !== null ? (d.plTotal >= 0 ? 'positive' : 'negative') : ''}" style="font-weight:bold;">${fmt(d.plTotal)}</td>
                    <td>
                        <button class="btn-action btn-edit" onclick="editDia('${d.id}')" title="Editar">‚úèÔ∏è</button>
                        <button class="btn-action" onclick="deleteDia('${d.id}')" title="Excluir">üóëÔ∏è</button>
                    </td>
                </tr>
            `).join('');

            renderMonthlySummary();
        }
    </script>
</body>
</html>

